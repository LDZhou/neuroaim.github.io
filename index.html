<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Neuro-Aim: Optimized Protocol</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=JetBrains+Mono:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<div class="bg-grid"></div>

<!-- ===== MENU SCREEN ===== -->
<div id="menu-screen" class="screen active">
    <div class="logo">
        <h1>NEURO-AIM</h1>
        <div class="subtitle">Neuro-Optimized Protocol</div>
    </div>
    
    <div class="mode-selector">
        <!-- MODE 1 -->
        <div class="mode-card">
            <div onclick="event.stopPropagation(); showDifficultyModal(1)" style="width:100%; height:100%; position:absolute; top:0; left:0; cursor:pointer; z-index:1;"></div>
            <span class="mode-num">01</span>
            <button class="info-btn" onclick="event.stopPropagation(); showModeInfo(1)">?</button>
            <h3>GABOR SCOUT</h3>
            <p>Identify <strong>Vertical</strong> targets in noise.</p>
            <span class="tag">V1 CORTEX + PERCEPTION</span>
        </div>
        
        <!-- MODE 2 -->
        <div class="mode-card">
            <div onclick="event.stopPropagation(); showDifficultyModal(2)" style="width:100%; height:100%; position:absolute; top:0; left:0; cursor:pointer; z-index:1;"></div>
            <span class="mode-num">02</span>
            <button class="info-btn" onclick="event.stopPropagation(); showModeInfo(2)">?</button>
            <h3>PURE TRACKING</h3>
            <p>Smooth pursuit. Track, hold, and <strong>stay steady after kill</strong>.</p>
            <span class="tag">MT/V5 + PURSUIT + AFTERGAZE</span>
        </div>
        
        <!-- MODE 3 -->
        <div class="mode-card">
            <div onclick="event.stopPropagation(); showDifficultyModal(3)" style="width:100%; height:100%; position:absolute; top:0; left:0; cursor:pointer; z-index:1;"></div>
            <span class="mode-num">03</span>
            <button class="info-btn" onclick="event.stopPropagation(); showModeInfo(3)">?</button>
            <h3>SURGICAL LOCK</h3>
            <p>Zero tolerance. Hit <strong>Random Core</strong>. Avoid Halo.</p>
            <span class="tag">PREMOTOR + INHIBITION</span>
        </div>
        
        <!-- MODE 4 -->
        <div class="mode-card">
            <div onclick="event.stopPropagation(); showDifficultyModal(4)" style="width:100%; height:100%; position:absolute; top:0; left:0; cursor:pointer; z-index:1;"></div>
            <span class="mode-num">04</span>
            <button class="info-btn" onclick="event.stopPropagation(); showModeInfo(4)">?</button>
            <h3>LANDOLT SACCADE</h3>
            <p><strong>Click Center</strong> → Find Target → Click Target → Repeat.</p>
            <span class="tag">FOVEAL + SACCADE + RESET</span>
        </div>
    </div>
    
    <div class="menu-nav">
        <a onclick="showScreen('stats-screen')">STATISTICS</a>
        <a onclick="showSettings()">SETTINGS</a>
    </div>
</div>

<!-- ===== DIFFICULTY MODAL ===== -->
<div class="difficulty-modal hidden" id="difficulty-modal">
    <div class="difficulty-content">
        <h3 id="diff-modal-title">SELECT DIFFICULTY</h3>
        <div class="difficulty-options">
            <div class="diff-card" onclick="selectDifficulty('easy')">
                <div class="diff-level">EASY</div>
                <div class="diff-desc">Baseline · Clean</div>
            </div>
            <div class="diff-card" onclick="selectDifficulty('medium')">
                <div class="diff-level">MEDIUM</div>
                <div class="diff-desc">Visual Crowding</div>
            </div>
            <div class="diff-card" onclick="selectDifficulty('hard')">
                <div class="diff-level">HARD</div>
                <div class="diff-desc">Neural Limit · Strobe</div>
            </div>
        </div>
        <button class="diff-cancel" onclick="hideDifficultyModal()">CANCEL</button>
    </div>
</div>

<!-- ===== INFO MODAL ===== -->
<div class="info-modal hidden" id="info-modal">
    <div class="info-content" id="info-content"></div>
</div>

<!-- ===== SETTINGS MODAL ===== -->
<div class="settings-modal hidden" id="settings-modal">
    <div class="settings-content">
        <h2>SETTINGS</h2>
        <div class="settings-section">
            <h3>MOUSE SENSITIVITY</h3>
            <div class="setting-row">
                <div><label>Sensitivity Multiplier</label></div>
                <div class="scale-control">
                    <input type="range" class="scale-slider" id="setting-sensitivity" min="0.5" max="3" step="0.1" value="1" oninput="updateSensitivity(this.value)">
                    <span class="scale-value" id="sens-value">1.0x</span>
                </div>
            </div>
        </div>
        <div class="settings-section">
            <h3>MODE CONFIG</h3>
            <div class="setting-row">
                <div><label>Adaptive Contrast (Mode 1)</label></div>
                <label class="toggle-switch">
                    <input type="checkbox" id="setting-adaptiveContrast" onchange="updateSetting('adaptiveContrast', this.checked)">
                    <span class="toggle-slider"></span>
                </label>
            </div>
        </div>
        <div class="settings-section">
            <h3>CROSSHAIR</h3>
            <div class="crosshair-grid">
                <div class="crosshair-option" onclick="setCrosshair('cross')" data-ch="cross"><svg viewBox="0 0 32 32"><line x1="6" y1="16" x2="12" y2="16" stroke="#00d9ff" stroke-width="1.5"/><line x1="20" y1="16" x2="26" y2="16" stroke="#00d9ff" stroke-width="1.5"/><line x1="16" y1="6" x2="16" y2="12" stroke="#00d9ff" stroke-width="1.5"/><line x1="16" y1="20" x2="16" y2="26" stroke="#00d9ff" stroke-width="1.5"/></svg></div>
                <div class="crosshair-option" onclick="setCrosshair('dot')" data-ch="dot"><svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="3" fill="#00d9ff"/></svg></div>
                <div class="crosshair-option" onclick="setCrosshair('circle')" data-ch="circle"><svg viewBox="0 0 32 32"><circle cx="16" cy="16" r="10" fill="none" stroke="#00d9ff" stroke-width="1.5"/><circle cx="16" cy="16" r="2" fill="#00d9ff"/></svg></div>
            </div>
            <div class="setting-row">
                <label>Scale</label>
                <div class="scale-control">
                    <input type="range" class="scale-slider" id="setting-scale" min="0.5" max="2" step="0.1" value="1" oninput="updateCrosshairScale(this.value)">
                    <span class="scale-value" id="scale-value">1.0x</span>
                </div>
            </div>
            <div class="crosshair-preview"><canvas id="crosshair-preview-canvas"></canvas></div>
        </div>
        <div class="settings-actions">
            <button onclick="resetSettings()">RESET</button>
            <button class="primary" onclick="closeSettings()">SAVE & CLOSE</button>
        </div>
    </div>
</div>

<!-- ===== GAME SCREEN ===== -->
<div id="game-screen" class="screen">
    <canvas id="game-canvas"></canvas>
    <div class="game-hud">
        <div class="hud-item"><div class="label">TIME</div><div class="value time" id="hud-time">60</div></div>
        <div class="hud-item"><div class="label">SCORE</div><div class="value score" id="hud-score">0</div></div>
        <div class="hud-item"><div class="label">ACCURACY</div><div class="value accuracy" id="hud-accuracy">--%</div></div>
    </div>
    <div class="escape-hint">[ESC] PAUSE</div>
    <div class="countdown-overlay" id="countdown-overlay">
        <div class="click-prompt" id="click-prompt">CLICK TO BEGIN</div>
        <div class="countdown-text" id="countdown-text" style="display:none">3</div>
    </div>
    <div class="pause-modal hidden" id="pause-modal">
        <h2>PAUSED</h2>
        <div class="buttons"><button onclick="resumeGame()">RESUME</button><button class="danger" onclick="confirmQuit()">QUIT</button></div>
    </div>
    <div class="pause-modal hidden" id="quit-confirm">
        <h2>CONFIRM QUIT?</h2>
        <div class="buttons"><button onclick="cancelQuit()">CANCEL</button><button class="danger" onclick="quitGame()">QUIT</button></div>
    </div>
</div>

<!-- ===== RESULT SCREEN ===== -->
<div id="result-screen" class="screen">
    <div class="result-header"><h2>SESSION COMPLETE</h2></div>
    <div class="result-score"><div class="big-score" id="result-score">0</div><div class="score-label">TOTAL SCORE</div></div>
    <div class="result-stats">
        <div class="result-stat"><div class="val" id="result-hits">0</div><div class="lbl">HITS</div></div>
        <div class="result-stat"><div class="val" id="result-misses">0</div><div class="lbl">MISSES</div></div>
        <div class="result-stat"><div class="val" id="result-accuracy">0%</div><div class="lbl">ACCURACY</div></div>
        <div class="result-stat"><div class="val" id="result-avgrt">--</div><div class="lbl">AVG RT (MS)</div></div>
    </div>
    <div class="result-actions"><button onclick="showScreen('menu-screen')">MENU</button><button class="primary" onclick="restartGame()">AGAIN</button></div>
</div>

<!-- ===== STATS SCREEN ===== -->
<div id="stats-screen" class="screen">
    <div class="stats-header">
        <h2>ANALYTICS</h2>
        <button class="back-btn" onclick="showScreen('menu-screen')">← BACK</button>
    </div>
    <!-- Content populated by stats.js -->
</div>

<!-- FLASH EFFECTS -->
<div class="flash-overlay penalty" id="flash-penalty"></div>
<div class="flash-overlay warn" id="flash-warn"></div>
<div class="flash-text penalty" id="flash-text-penalty">INVALID</div>
<div class="flash-text warn" id="flash-text-warn">BROKE GAZE</div>

<script src="js/config.js"></script>
<script src="js/settings.js"></script>
<script src="js/audio.js"></script>
<script src="js/data.js"></script>
<script src="js/noise.js"></script>
<script src="js/renderer.js"></script>
<script src="js/game-modes.js"></script>
<script src="js/game-engine.js"></script>
<script src="js/stats.js"></script>
<script src="js/ui.js"></script>
<script src="js/main.js"></script>

<script>
let selectedModeForDifficulty = 1;
function showDifficultyModal(mode) {
    selectedModeForDifficulty = mode;
    const m = document.getElementById('difficulty-modal');
    if(m) m.classList.remove('hidden');
}
function hideDifficultyModal() {
    const m = document.getElementById('difficulty-modal');
    if(m) m.classList.add('hidden');
}
function selectDifficulty(diff) {
    startGame(selectedModeForDifficulty, diff);
}
</script>
</body>
</html>